<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Failure Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .section { display: none; }
        .section.active { display: block; }
        .transition-all { transition: all 0.3s ease; }
        .error-border { border-color: #ef4444 !important; }
        .note { font-size: 0.875rem; color: #6b7280; }
        .section-title { font-size: 1.125rem; font-weight: 600; color: #1d4ed8; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto max-w-lg p-6 bg-white rounded-xl shadow-lg mt-10">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">Heart Failure Prediction</h2>
        <div class="text-center text-gray-600 mb-4">
            Enter the patient's clinical data to predict the risk of heart failure.<br>
            <span class="note">All fields are required.</span>
        </div>
        <form id="prediction-form" method="post" action="/" autocomplete="off" class="space-y-4">
            <div id="demographics-section" class="section active transition-all">
                <div class="section-title mb-3">Demographics</div>
                <div class="space-y-3">
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">Age (years)</label>
                        <input type="number" name="age" min="18" max="120" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="sex" class="block text-sm font-medium text-gray-700">Sex</label>
                        <select name="sex" required
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>Select</option>
                            <option value="1">Male</option>
                            <option value="0">Female</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="medical-history-section" class="section transition-all">
                <div class="section-title mb-3">Medical History</div>
                <div class="space-y-3">
                    <div>
                        <label for="smoking" class="block text-sm font-medium text-gray-700">Smoking</label>
                        <select name="smoking" required
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="diabetes" class="block text-sm font-medium text-gray-700">Diabetes</label>
                        <select name="diabetes" required
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="anaemia" class="block text-sm font-medium text-gray-700">Anaemia</label>
                        <select name="anaemia" required
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="high_blood_pressure" class="block text-sm font-medium text-gray-700">High Blood Pressure</label>
                        <select name="high_blood_pressure" required
                                class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>Select</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="clinical-section" class="section transition-all">
                <div class="section-title mb-3">Clinical Measurements</div>
                <div class="space-y-3">
                    <div>
                        <label for="creatinine_phosphokinase" class="block text-sm font-medium text-gray-700">Creatinine Phosphokinase (mcg/L)</label>
                        <input type="number" name="creatinine_phosphokinase" min="10" max="10000" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="ejection_fraction" class="block text-sm font-medium text-gray-700">Ejection Fraction (%)</label>
                        <input type="number" name="ejection_fraction" min="10" max="80" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="platelets" class="block text-sm font-medium text-gray-700">Platelets (kiloplatelets/mL)</label>
                        <input type="number" name="platelets" min="100" max="500" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="serum_creatinine" class="block text-sm font-medium text-gray-700">Serum Creatinine (mg/dL)</label>
                        <input type="number" name="serum_creatinine" min="0.1" max="10" step="0.1" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="serum_sodium" class="block text-sm font-medium text-gray-700">Serum Sodium (mEq/L)</label>
                        <input type="number" name="serum_sodium" min="100" max="160" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">Follow-up Period (days)</label>
                        <input type="number" name="time" min="1" max="365" required
                               class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-4">
                <button type="button" id="next-btn" class="flex-1 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-all">Next</button>
                <button type="submit" id="predict-btn" class="flex-1 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-all hidden">Predict</button>
            </div>
        </form>
        <div id="prediction-result" class="mt-6 text-center text-lg text-gray-800"></div>
    </div>

    <script>
        const sections = [
            document.getElementById('demographics-section'),
            document.getElementById('medical-history-section'),
            document.getElementById('clinical-section')
        ];
        const nextBtn = document.getElementById('next-btn');
        const predictBtn = document.getElementById('predict-btn');
        let currentSection = 0;

        function updateSections() {
            sections.forEach((section, index) => {
                section.classList.toggle('active', index === currentSection);
            });
            nextBtn.textContent = currentSection === sections.length - 1 ? 'Back' : 'Next';
            predictBtn.classList.toggle('hidden', currentSection !== sections.length - 1);
        }

        nextBtn.addEventListener('click', () => {
            if (currentSection < sections.length - 1) {
                currentSection++;
            } else {
                currentSection--;
                if (currentSection < 0) currentSection = 0;
            }
            updateSections();
        });

        document.getElementById('prediction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const params = new URLSearchParams();
            for (const pair of formData) {
                params.append(pair[0], pair[1]);
            }
            predictBtn.textContent = 'Predicting...';
            predictBtn.disabled = true;
            try {
                const response = await fetch('/', {
                    method: 'POST',
                    body: params,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                const html = await response.text();
                document.getElementById('prediction-result').innerHTML = html;
            } catch (error) {
                document.getElementById('prediction-result').innerHTML = '<span class="text-red-500">Error: Unable to process prediction</span>';
            } finally {
                predictBtn.textContent = 'Predict';
                predictBtn.disabled = false;
            }
        });

        // Add real-time validation for input fields
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', () => {
                input.classList.toggle('error-border', !input.validity.valid);
            });
        });

        updateSections();
    </script>
</body>
</html>
